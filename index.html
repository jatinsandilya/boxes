<!DOCTYPE html>
<html>
<meta http-equiv="Content-Type" content="text/html;charset=ISO-8859-8">
<head><title>Boxes</title>
</head>
<style type="text/css">
#screen {
	position: absolute;
}	
</style>
<body>
	<canvas id= 'screen' width='480' height ='320'></canvas>
</body>


<script type="text/javascript">
	
(function(){

    


  raf = window.requestAnimationFrame;
  var GAME = GAME || {};//sed for namespacing

var canvas = document.getElementById('screen');
	canvas.addEventListener("mousedown",function(event){player.updateXY(event.clientX,event.clientY);});
  CTX = canvas.getContext("2d");
	WIDTH = canvas.width;
	HEIGHT = canvas.height;
var player = {
		x: WIDTH/2,
		y:HEIGHT/2,
		RADIUS:30,
		new_x:WIDTH/2,
		new_y:HEIGHT/2,
		// speedX:1,
  //   speedY:1,
    
		speed:5,
		
    updateXY:function(x,y){
			this.new_x = x;
			this.new_y = y;
      this.speedX = Math.abs(this.x-this.new_x)/40;
      this.speedY = Math.abs(this.y-this.new_y)/40;
			console.log(this.x,this.y);
      
		},
		
//Need to update this function with a tolerance for the update of coordinates to happen to avoid stutter!!
    

    updateCoordinates:function(){
        
        if(this.new_x - this.x < this.speedX){
        	this.x = this.x - this.speedX;

        }
        else if(this.new_x - this.x > this.speedX){
        	this.x = this.x + this.speedX;
        };

        if(this.new_y - this.y < this.speedY){
        	this.y= this.y - this.speedY;
        }

        else if (this.new_y - this.y >this.speedY){
        	this.y= this.y+ this.speedY;
         };
        // console.log('player moved to ',this.new_x,this.new_y);
		},
    
  render:function(){

    CTX.beginPath();
    CTX.arc(this.x,this.y,this.RADIUS,0,2*Math.PI);
    CTX.fillStyle = 'black';
    CTX.fill();
    CTX.closePath();
    
    // CTX.fillStyle = 'black';
    // CTX.fillRect(this.x,this.y,30,30);

    }

	};
    
  



  GAME.update = function(blocks){

    for (i in blocks) {
      blocks[i].update();
    };

   	player.updateCoordinates();
   
   };

    




  GAME.render = function(blocks){
    
    CTX.clearRect(0,0,WIDTH,HEIGHT);
    player.render();
  
  for (i in blocks) {
  blocks[i].render();
  
  };
    
  };
  
  GAME.Init = function(noOfBlocks){
   
   listOfBlocks = [];


   var block = {
    
    initX:0,
    initY:0,
    currX:0,
    currY:0,
    RADIUS:15,
 speed:0,
    
    init :function(){

  
          this.dir= this.dir||Math.random()*2*Math.PI;
          this.speed=  (this.speed)||(Math.random()*10);//Need to define a clamp function to restrict the speed .
          this.initX = Math.floor(Math.random()*480);
          this.initY = Math.floor(Math.random()*320);
          this.currX = this.initX;
          this.currY = this.initY;
       },
    update:function(){ 
     if(this.currY > HEIGHT+10 || this.currX > WIDTH+10)
    { 
     this.init();
    }
    else
    {
    this.currX = this.currX + this.speed * Math.cos(this.dir);
     this.currY = this.currY - this.speed * Math.sin(this.dir);
    }
  }
};
  
   var redBlockFactory = function(){ 

      var obj = Object.create(block);
       
      obj.colour = "Red" ;

      obj.render = function(){
        
        CTX.beginPath();
        CTX.arc(this.currX,this.currY,this.RADIUS,0,2*Math.PI);
        CTX.fillStyle = "red";
        CTX.fill();
        CTX.closePath();
      };

      obj.init();

      return obj;   
   };       
  
   var blackBlockFactory = function(){
 
 var obj = Object.create(block);
      
     obj.colour = "Black"; 
       
     obj.render = function(){
        
        CTX.beginPath();
        CTX.arc(this.currX,this.currY,this.RADIUS,0,2*Math.PI);
        CTX.fillStyle = 'black';
        CTX.fill();
        CTX.closePath();
     };
     
     obj.init();
     
     return obj;

  };
 

  for (var i = 0; i < noOfBlocks; i++) {
  if(i < noOfBlocks/2)
    listOfBlocks.push(redBlockFactory());
  else
    listOfBlocks.push(blackBlockFactory());
  };

  console.log(listOfBlocks);

  };
 



  GameLoop = function(){
    
    
    GAME.update(listOfBlocks);

    GAME.render(listOfBlocks);

    raf(GameLoop);

  };
 

//Initializes random no.of blocks with random speeds and directions and any other initial requirements
 noOfBlocks = Math.floor(Math.random()*15);
 GAME.Init(noOfBlocks);


//Starts the game  
 raf(GameLoop);

})();
</script>
	
</html>